<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Android,Provision," />





  <link rel="alternate" href="/atom.xml" title="Wossoneri`s Blog" type="application/atom+xml" />






<meta name="description" content="Android Provision介绍">
<meta name="keywords" content="Android,Provision">
<meta property="og:type" content="article">
<meta property="og:title" content="[Android][Framework]Provision">
<meta property="og:url" content="http://wossoneri.github.io/2016/10/28/[Android][Framework]Provision/index.html">
<meta property="og:site_name" content="Wossoneri`s Blog">
<meta property="og:description" content="Android Provision介绍">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-07-31T06:19:38.232Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[Android][Framework]Provision">
<meta name="twitter:description" content="Android Provision介绍">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '6234852363740382000',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://wossoneri.github.io/2016/10/28/[Android][Framework]Provision/"/>





  <title>[Android][Framework]Provision | Wossoneri`s Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70716047-2', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?0af9c6850b24b42a4713ad1c9c691675";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/wossoneri"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/121cd7cbdc3e4855075ea8b558508b91ac463ac2/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_green_007200.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wossoneri`s Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">业 精于勤而荒于嬉，行 成于思而毁于随</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://wossoneri.github.io/2016/10/28/[Android][Framework]Provision/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Wossoneri">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars2.githubusercontent.com/u/11764431?v=3&s=460">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wossoneri`s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">[Android][Framework]Provision</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-28T02:42:26+08:00">
                2016-10-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/10/28/[Android][Framework]Provision/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2016/10/28/[Android][Framework]Provision/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
          
	
  		  <span class="post-letters-count">
            &nbsp; | &nbsp;
            <span class="post-meta-item-icon">
                 <i class="fa fa-clock-o" ></i>
            </span>
		        <span class="post-meta-item-text">总记</span>
            <span class="post-count">1,017 字</span>
		        <span class="post-meta-item-text">读完需要</span>
    		    <span class="post-count">5 分</span>
  		  </span>
           
         

          

          

          
              <div class="post-description">
                  Android Provision介绍
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Provision是什么？"><a href="#Provision是什么？" class="headerlink" title="Provision是什么？"></a>Provision是什么？</h3><p><code>Provision</code>的作用很简单，就是一个系统初始化引导程序，源生的Android里面<code>Provision</code>只做了一件事，就是写入一个<code>DEVICE_PROVISIONED</code>标记。</p>
<blockquote>
<p>这个标记作用很大，这个标记只会在系统 全新升级（双清）的时候写入一次，代表了Android系统升级准备完成，可以正常工作。</p>
</blockquote>
<h3 id="Provision在哪？"><a href="#Provision在哪？" class="headerlink" title="Provision在哪？"></a>Provision在哪？</h3><p>一般在<code>package</code>目录下:<code>package/apps/Provision</code>。</p>
<h3 id="Proision代码"><a href="#Proision代码" class="headerlink" title="Proision代码"></a>Proision代码</h3><p><code>Provision</code>下只有一个<code>Activity</code>文件和一个<code>Manifest</code>文件</p>
<h4 id="Manifest"><a href="#Manifest" class="headerlink" title="Manifest"></a>Manifest</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">"DefaultActivity"</span></span></span><br><span class="line"><span class="tag">          <span class="attr">android:excludeFromRecents</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">"android.intent.action.MAIN"</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.HOME"</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">"android.intent.category.DEFAULT"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置说明：</p>
<ul>
<li><code>android:excludeFromRecents=&quot;true&quot;</code> 不在<code>Recents</code>界面显示。</li>
<li><code>&lt;intent-filter android:priority=&quot;1&quot;&gt;</code> 优先级高于<code>Launcher</code>，所以会先于<code>Launcher</code>启动(因为系统Launcher没有显式设置priority值，所以默认是0)</li>
<li><code>category.HOME</code> 桌面程序标记，和<code>Launcher</code>属于一个级别</li>
</ul>
<h4 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle icicle)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.onCreate(icicle);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add a persistent setting to allow other apps to know the device has been provisioned.</span></span><br><span class="line">      Settings.Secure.putInt(getContentResolver(), Settings.Secure.DEVICE_PROVISIONED, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// remove this activity from the package manager.</span></span><br><span class="line">      PackageManager pm = getPackageManager();</span><br><span class="line">      ComponentName name = <span class="keyword">new</span> ComponentName(<span class="keyword">this</span>, DefaultActivity.class);</span><br><span class="line">      pm.setComponentEnabledSetting(name, PackageManager.COMPONENT_ENABLED_STATE_DISABLED,</span><br><span class="line">          PackageManager.DONT_KILL_APP);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// terminate the activity.</span></span><br><span class="line">      finish();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>源生代码很简单<br>做了两件事：</p>
<ol>
<li>设置<code>DEVICE_PROVISIONED</code>标记</li>
<li>禁止<code>Provision</code>自己的<code>Activity</code>组件</li>
</ol>
<p>对这个代码做点说明：<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Add a persistent setting to allow other apps to know the device has been provisioned.</span></span><br><span class="line">Settings.Secure.putInt(getContentResolver(), Settings.Secure.DEVICE_PROVISIONED, <span class="number">1</span>);</span><br></pre></td></tr></table></figure></p>
<p>注释表述很清楚：为设备写入持久的数据，并供其他App了解设备已经provision过。</p>
<blockquote>
<p><strong>class Settings</strong></p>
<p>The Settings provider contains global system-level device preferences.</p>
<p><strong>class Secure</strong></p>
<p>Secure system settings, containing system preferences that applications can read but are not allowed to write.  These are for preferences that the user must explicitly modify through the system UI or specialized APIs for those values, not modified directly by applications.</p>
<p><strong>public static boolean putInt(ContentResolver cr, String name, int value)</strong></p>
<p>Convenience function for updating a single settings value as an integer. This will either create a new entry in the table if the given name does not exist, or modify the value of the existing row with that name.  Note that internally setting values are always stored as strings, so this function converts the given value to a string before storing it.</p>
<ul>
<li>@param cr The ContentResolver to access.</li>
<li>@param name The name of the setting to modify.</li>
<li>@param value The new value for the setting.</li>
<li>@return true if the value was set, false on database errors</li>
</ul>
</blockquote>
<p>禁止组件的功能<br><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">pm.setComponentEnabledSetting(name, PackageManager.COMPONENT_ENABLED_STATE_DISABLED,</span><br><span class="line">    PackageManager.DONT_KILL_APP);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><strong>public abstract void setComponentEnabledSetting(ComponentName componentName,</strong><br>          <strong>int newState, int flags);</strong></p>
<p>Set the enabled setting for a package component (activity, receiver, service, provider). This setting will override any enabled state which may have been set by the component in its manifest.</p>
<ul>
<li><p>@param componentName The component to enable</p>
</li>
<li><p>@param newState The new enabled state for the component.  The legal values for this state are:</p>
<ul>
<li><p>COMPONENT_ENABLED_STATE_ENABLED</p>
</li>
<li><p>COMPONENT_ENABLED_STATE_DISABLED</p>
</li>
<li><p>COMPONENT_ENABLED_STATE_DEFAULT</p>
<p>The last one removes the setting, thereby restoring the component’s state to whatever was set in it’s manifest (or enabled, by default).</p>
</li>
</ul>
</li>
<li><p>@param flags Optional behavior flags: DONT_KILL_APP or 0.</p>
</li>
</ul>
</blockquote>
<p>功能禁止后，系统package信息会记录下来，保存在 <code>/data/system/packages.xml</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.android.provision"</span> <span class="attr">codePath</span>=<span class="string">"/system/app/Provision.apk"</span> <span class="attr">nativeLibraryPath</span>=<span class="string">"/data/data/com.android.provision/lib"</span></span></span><br><span class="line"><span class="tag"><span class="attr">flags</span>=<span class="string">"1"</span> <span class="attr">ft</span>=<span class="string">"11b7e237e00"</span> <span class="attr">it</span>=<span class="string">"11b7e237e00"</span></span></span><br><span class="line"><span class="tag"><span class="attr">ut</span>=<span class="string">"11b7e237e00"</span> <span class="attr">version</span>=<span class="string">"15"</span> <span class="attr">userId</span>=<span class="string">"10005"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sigs</span> <span class="attr">count</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cert</span> <span class="attr">index</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">sigs</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">disabled-components</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"com.android.provision.DefaultActivity"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">disabled-components</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这段代码就是记录的禁止<code>DefaultActivity</code>的信息。所以这个组件只会运行一次，之后就被禁止运行了。除非格式化<code>/data/</code>目录。</p>
<h3 id="5X实现"><a href="#5X实现" class="headerlink" title="5X实现"></a>5X实现</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Application that sets the provisioned bit, like SetupWizard does.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ORIGINAL_LAUNCHER_PACKAGENAME = <span class="string">"com.android.launcher3"</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ORIGINAL_LAUNCHER_CLASSNAME = <span class="string">"com.android.launcher3.Launcher"</span>;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle icicle)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.onCreate(icicle);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Add a persistent setting to allow other apps to know the device has been provisioned.</span></span><br><span class="line">      Settings.Global.putInt(getContentResolver(), Settings.Global.DEVICE_PROVISIONED, <span class="number">1</span>);</span><br><span class="line">      Settings.Secure.putInt(getContentResolver(), Settings.Secure.USER_SETUP_COMPLETE, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// remove this activity from the package manager.</span></span><br><span class="line">      PackageManager pm = getPackageManager();</span><br><span class="line">      ComponentName name = <span class="keyword">new</span> ComponentName(<span class="keyword">this</span>, DefaultActivity.class);</span><br><span class="line"></span><br><span class="line">      pm.setComponentEnabledSetting(name, PackageManager.COMPONENT_ENABLED_STATE_DISABLED,</span><br><span class="line">              PackageManager.DONT_KILL_APP);</span><br><span class="line">      <span class="comment">//set Launcher3 as the preferred home activity</span></span><br><span class="line">      setupDefaultLauncher(pm);</span><br><span class="line">      <span class="comment">// terminate the activity.</span></span><br><span class="line">      finish();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupDefaultLauncher</span><span class="params">(PackageManager pm)</span></span>&#123;</span><br><span class="line">      Intent queryIntent = <span class="keyword">new</span> Intent();</span><br><span class="line">      queryIntent.addCategory(Intent.CATEGORY_HOME);</span><br><span class="line">      queryIntent.setAction(Intent.ACTION_MAIN);  <span class="comment">// 查找符合 Launcher 的 activity</span></span><br><span class="line"></span><br><span class="line">      List&lt;ResolveInfo&gt; homeActivities = pm.queryIntentActivities(queryIntent, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span>(homeActivities == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      ComponentName defaultLauncher = <span class="keyword">new</span> ComponentName(ORIGINAL_LAUNCHER_PACKAGENAME,</span><br><span class="line">              ORIGINAL_LAUNCHER_CLASSNAME);</span><br><span class="line">      <span class="keyword">int</span> activityNum = homeActivities.size();</span><br><span class="line">      ComponentName[] set = <span class="keyword">new</span> ComponentName[activityNum];</span><br><span class="line">      <span class="keyword">int</span> defaultMatch = -<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; activityNum; i++)&#123; <span class="comment">//从符合 Launcher 中查找 Launcher3</span></span><br><span class="line">          ResolveInfo info = homeActivities.get(i);</span><br><span class="line">          set[i] = <span class="keyword">new</span> ComponentName(info.activityInfo.packageName, info.activityInfo.name);</span><br><span class="line">          <span class="keyword">if</span>(ORIGINAL_LAUNCHER_CLASSNAME.equals(info.activityInfo.name)</span><br><span class="line">                  &amp;&amp; ORIGINAL_LAUNCHER_PACKAGENAME.equals(info.activityInfo.packageName))&#123;</span><br><span class="line">              defaultMatch = info.match;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//if Launcher3 is not found, do not set anything</span></span><br><span class="line">      <span class="keyword">if</span>(defaultMatch == -<span class="number">1</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      IntentFilter filter = <span class="keyword">new</span> IntentFilter();</span><br><span class="line">      filter.addAction(Intent.ACTION_MAIN);</span><br><span class="line">      filter.addCategory(Intent.CATEGORY_HOME);</span><br><span class="line">      filter.addCategory(Intent.CATEGORY_DEFAULT);</span><br><span class="line"></span><br><span class="line">      pm.addPreferredActivity(filter, defaultMatch, set, defaultLauncher);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Reference<br><a href="http://www.cnblogs.com/mythou/p/3425570.html" target="_blank" rel="external">Android 初始化Setup Wizard——Provision</a></p>
</blockquote>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="https://github.com/wossoneri/wossoneri.github.io/blob/master/pay/wechatpay.JPG?raw=true" alt="Wossoneri 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="https://github.com/wossoneri/wossoneri.github.io/blob/master/pay/alipay.JPG?raw=true" alt="Wossoneri 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Wossoneri
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://wossoneri.github.io/2016/10/28/[Android][Framework]Provision/" title="[Android][Framework]Provision">http://wossoneri.github.io/2016/10/28/[Android][Framework]Provision/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"><i class="fa fa-tag"></i> Android</a>
          
            <a href="/tags/Provision/" rel="tag"><i class="fa fa-tag"></i> Provision</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/10/15/[Android]Multimedia-database/" rel="next" title="[Android]多媒体数据库">
                <i class="fa fa-chevron-left"></i> [Android]多媒体数据库
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/03/09/[Design-Pattern]TemplateMethod/" rel="prev" title="[设计模式]之二十:模板方法模式">
                [设计模式]之二十:模板方法模式 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      
        <div id="gitment-container"></div>
      
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars2.githubusercontent.com/u/11764431?v=3&s=460"
                alt="Wossoneri" />
            
              <p class="site-author-name" itemprop="name">Wossoneri</p>
              <p class="site-description motion-element" itemprop="description">就怕你一生碌碌无为，还安慰自己平凡可贵</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">101</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">17</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">103</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/wossoneri" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://weibo.com/u/1171637315/home?topnav=1&wvr=5" target="_blank" title="Weibo">
                    
                      <i class="fa fa-fw fa-globe"></i>Weibo</a>
                </span>
              
            
          </div>

          
          
            <div class="cc-license motion-element" itemprop="license">
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
                <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
              </a>
            </div>
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.cnblogs.com/rossoneri/" title="我的博客园博客" target="_blank">我的博客园博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://zhangqinglian.github.io/" title="清廉的Android博客" target="_blank">清廉的Android博客</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Provision是什么？"><span class="nav-number">1.</span> <span class="nav-text">Provision是什么？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Provision在哪？"><span class="nav-number">2.</span> <span class="nav-text">Provision在哪？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Proision代码"><span class="nav-number">3.</span> <span class="nav-text">Proision代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Manifest"><span class="nav-number">3.1.</span> <span class="nav-text">Manifest</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Activity"><span class="nav-number">3.2.</span> <span class="nav-text">Activity</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5X实现"><span class="nav-number">4.</span> <span class="nav-text">5X实现</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wossoneri</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    
      <script type="text/javascript">
      function renderGitment(){
        var gitment = new Gitmint({
            id: '1477593746000', 
            owner: 'wossoneri',
            repo: 'wossoneri.github.io',
            
            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,
            
            oauth: {
            
            
                client_secret: '9d7241035e9211e280e753883f5b8f5a1a49bf77',
            
                client_id: '40b6c719a11e3fca29e8'
            }});
        gitment.render('gitment-container');
      }

      
      renderGitment();
      
      </script>
    







  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
